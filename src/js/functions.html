<script>

// Make query params available in this file
<? for(var key in atts) {?>
    var <?!= key; ?> = <?= atts[key]; ?>;
<? } ?>


function getFormValues(container) {

    var values = [];
    $(container).find('input, select, textarea').each(function() {

        var val = $(this).val();
        if($(this).attr('required') && val === '') {
            var message = 'Not all required fields are filled. Please check your input and try again.';
            showModal('Oops!', message);
            throw message;
        }

        values.push(val);

    });

    return values;

}


function setContent(template, atts, after) {

    var target = '#dynamic-content';
    $(target).empty();
    appendContent(target, template, atts, after);

}


function appendContent(target, template, atts, after) {

    runFunction('templatePart', [template, atts], function(content) {

        $(target).append(content);

        $('select').select2({'theme': 'bootstrap'});
        $('.data-table').DataTable();
        if(_.isFunction(after)) after.apply(this);

    });

};


function runFunction(func, args, success) {

    return google.script.run
    .withSuccessHandler(success)
    .withFailureHandler(function(error) {
        var title = 'Something went terribly wrong...';
        showModal(title, error.message);
    })[func].apply(this, args);

}


function showModal(title, message) {

    $('.modal-title').html(title);
    $('.modal-body').html(message);
    $('.modal').modal();

};

</script>