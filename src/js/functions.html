<script>

window.onerror = function myErrorHandler(errorMsg, url, lineNumber) {

    showModal('That is not good...', errorMsg);
    loading.stop();

    return false;

}


function getFormValues(container) {

    var values = [];
    $(container).find('input, select, textarea').each(function() {

        var val = $(this).val();
        if($(this).attr('required') && val === '') {

            var message = 'Not all required fields are filled. Please check your input and try again.';
            showModal('Oops!', message);
            throw message;

        }

        if($(this).data('type') === 'formula' && val[0] !== '=') {
            values.push('');
        } else {
            values.push(val);
        }

    });

    return values;

}


function setContent(template, atts, after) {

    var target = '#dynamic-content';

    runFunction('templatePart', [template, atts], function(content) {

        $(target).empty();
        $(target).append(content);

        $('.select2').select2({'theme': 'bootstrap'});
        $('.data-table').DataTable();

        if(_.isFunction(after)) after.apply(this);

        window.scrollTo(0, 0);
        loading.stop();

    });

}


function runFunction(func, args, success) {

    return google.script.run
    .withSuccessHandler(success)
    .withFailureHandler(function(error) {

        var title = 'Something went terribly wrong...';
        showModal(title, error.message);
        loading.stop();

    })[func].apply(this, args);

}


function showModal(title, message) {

    $('.modal-title').html(title);
    $('.modal-body').html(message);
    $('.modal').modal();

};


var loading = {

    start: function() {
        $('.progress').show();
    },

    stop: function() {
        $('.progress').hide();
    }


}

</script>