<script>

$(document).ready(function() {

    // Make query params available in this file
    <? for(var key in atts) {?>
        var <?!= key; ?> = <?= atts[key]; ?>;
    <? } ?>

    $('body').on('click change', '.trigger-action', function(e) {

        // make sure event is not fired multiple times
        if(e.handled === true) return;
        e.handled = true;

        $('.progress').show();

        var data = $(this).data();

        // A form-values data attribute will get the values of all fields in the specified container container
        if(data.formValues) {
            data.formValues = getFormValues(data.formValues);
        }

        runFunction(data.action, [data], function(result) {

            if(data.modal) {
                showModal('Action completed succesfully', result || data.modal || 'Great!');
            };

            if(data.template) {
                setContent(data.template, data, function() {
                    $('.progress').hide();
                });
            }

        });

    });


    $('body').on('click change', '.set-content', function(e) {

        // make sure event is not fired multiple times
        if(e.handled === true) return;
        e.handled = true;

        $('.progress').show();

        var data = $(this).data();

        if(e.type === 'change') {
            data[data['value']] = $(this).val();

            // select2 appends an attribute to the data which can't be handled by the template. Here I'm overriding it.
            data.select2 = '';
        }

        setContent(data.template, data, function() {
            $('.progress').hide();
        });

    });


    // Support for multilevel dropdown
    $('ul.dropdown-menu [data-toggle=dropdown]').on('click', function(event) {

		event.preventDefault();
		event.stopPropagation();
		$(this).parent().siblings().removeClass('open');
		$(this).parent().toggleClass('open');

	});

});

</script>